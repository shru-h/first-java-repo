pipeline {
  agent any
  stages {
    stage("stage1 : checkout stage") {
      steps {
git branch :'main' , url: 'https://github.com/shru-h/first-java-repo'  
    }
    }
stage("stage2:compile the code"){
        steps{
        sh "mvn compile"
      }
    }
    stage("stage3:SonarQube analysis") {
      steps {
        withSonarQubeEnv('my-sonarqube-server') {
          sh 'mvn sonar:sonar'
        }
      }
    }
    stage("stage4:Quality Gate") {
      steps {
        timeout(time: 1, unit: 'HOURS') {
          def qg = waitForQualityGate()
          if (qg.status != 'OK') {
            error "Pipeline aborted due to quality gate failure: ${qg.status}"
          }
        }
      }
    }
  }
}

